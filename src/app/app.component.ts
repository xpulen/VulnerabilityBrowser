import {Component, OnInit} from '@angular/core';
import {HttpClient, HttpParams} from '@angular/common/http';
import {FusekiResponseModel} from './fusekiResponse.model';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: [
    './app.component.css'
  ]
})
export class AppComponent implements OnInit {
  title = 'VulnerabilityBrowser';
  childrenQuery: FusekiResponseModel;
  parentQuery: FusekiResponseModel;
  searchInput = '<http://FEI-STU/TP2019/Security/CVE-1999-0001>';

  constructor(private http: HttpClient) {
  }

  ngOnInit() {

  }

  runQueries(override = '') {
    if (override !== '') {
      this.searchInput = override;
    }
    this.getChildren();
    this.getParents();
  }

  getChildren() {
    let searchParams = new HttpParams();
    searchParams = searchParams.append('query',
      'SELECT ?subject ?predicate ?object ' +
      'WHERE {' +
      `${this.searchInput} ?predicate ?object` +
      '}' +
      'LIMIT 25');
    searchParams = searchParams.append('output', 'json');
    this.http
      .get<FusekiResponseModel>(
        'http://147.175.121.215:3030/cve-oval-cwe/sparql',
        {
          params: searchParams
        }
      )
      .subscribe((res: FusekiResponseModel) => {
        this.childrenQuery = res;
        // console.log(res);
      });
  }

  getParents() {
    let searchParams = new HttpParams();
    searchParams = searchParams.append('query',
      'SELECT ?subject ?predicate ?object ' +
      'WHERE {' +
      `?subject ?predicate ${this.searchInput}` +
      '}' +
      'LIMIT 25');
    searchParams = searchParams.append('output', 'json');
    this.http
      .get<FusekiResponseModel>(
        'http://147.175.121.215:3030/cve-oval-cwe/sparql',
        {
          params: searchParams
        }
      )
      .subscribe((res: FusekiResponseModel) => {
        this.parentQuery = res;
        console.log(res);
      });
  }
}
